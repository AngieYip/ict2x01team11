<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <title>CycleMyLyfe • Level 2</title>
        <meta name="description" content="Road Safety • Level 2">
		<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
		<script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
		<script src="js/aframe-dialog-popup-component.js"></script>
	</head>
	<body>
		<script type="text/javascript">
			var bicycle_position;
			document.addEventListener("DOMContentLoaded", function() {
				lights_element = document.querySelector('a-entity[light]');
				bicycle_position = document.getElementById('user_bicycle');

				var scene = document.querySelector('a-scene');
		    	var dialog_element = document.createElement('a-entity');
		    	scene.appendChild(dialog_element);
		    	
			    if (confirm("It's nighttime. Turn on your headlights?")) {
			    	dialog_element.innerHTML = "<dialog id='dialog'><form method='dialog'><p><label>Good job! You have followed the rules of cycling by turning on your headlights.</label></p><menu><button>Ok</button></menu></form></dialog>";
			    	
			    } else {
			    	dialog_element.innerHTML = "<dialog id='dialog'><form method='dialog'><p><label>Oh no! I hope you understand that cycling on a public road after dark without lights is illegal. Please be careful next time.</label></p><menu><button>Ok</button></menu></form></dialog>";
			        lights_element.removeAttribute('light');
			    }

			    var dialog = document.getElementById('dialog');
		    	dialog.showModal();
			});
		</script>

		<a-scene>
			<!-- ASSETS -->
			<a-assets>
		      	<img id="pedestrian" src="images/stickman.png">
		      	<img id="cyclist" src="images/cyclists.png">
				<a-asset-item id="paths" src="models/paths/CUPIC_ROAD.gltf"></a-asset-item>
			    <a-asset-item id="bicycle" src="models/bicycle/Bike.gltf"></a-asset-item>
			</a-assets>

			<!-- DIALOG -->
			<!-- <a-camera id="camera" cursor="rayOrigin: mouse"></a-camera>
			<a-entity id="dialog" position="-0.2 2 -2" scale="0.1 0.1 0.1" dialog-popup="
					title: Alert!;
			        body:  Please pick a lane.;">
		    </a-entity> -->

		    <!-- USER MODEL -->
			<a-entity id="user_model" position="0 1.8 -0.5">
				<a-camera id="cam" user-height="1.8" wasd-controls="acceleration: 100">
					<a-entity id="user_bicycle" gltf-model="#bicycle" scale="0.001 0.001 0.001" position="0 -0.780 -0.5" rotation="0 180 0"></a-entity>
					<a-entity light="type: point; intensity: 5; distance: 50; decay: 2" position="0 -0.276 -4.037"></a-entity>
					<a-sphere raycaster="objects: .collidable; near: 0.2" position="0 -0.9 0" geometry="radius:0.5"></a-sphere>
					<a-entity raycaster="objects: .collidable; near: 0.2" rotation="0 90 0"></a-entity>
					<a-entity raycaster="objects: .collidable; near: 0.2" rotation="0 270 0"></a-entity>
				</a-camera>
			</a-entity>

			<a-entity gltf-model="#paths" scale="0.05 0.05 0.05" position="0.053 -0.563 -30"></a-entity>

			<!-- PEDESTRIAN LANE -->
			<a-image src="#pedestrian" scale="2 2 2" rotation="-90 0 0" position="-2.921 0.031 -12.12"></a-image>

			<!-- PMD LANE -->
			<a-image src="#cyclist" scale="2 2 2" rotation="-90 0 0" position="2.889 0.031 -11.553"></a-image>

			<!-- BACKGROUND -->
			<a-entity environment="lightPosition:100 1; ground:flat; groundColor:#454545; groundColor2:#454545;"></a-entity>
		</a-scene>
	</body>
</html>